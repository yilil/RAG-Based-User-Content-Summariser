1ï¼Œæµç¨‹å›¾ï¼š



2ï¼Œé¡¹ç›®ç»“æ„å›¾ï¼š
ï¼ˆreadmeæ ¼å¼åˆ°æ—¶å€™ç›´æ¥å¤åˆ¶ä¸Šå»ï¼‰
## é¡¹ç›®ç»“æ„å›¾

ä¸‹é¢æ˜¯é¡¹ç›®çš„ä¸»è¦ç›®å½•å’Œæ–‡ä»¶ç»“æ„ï¼Œä»¥åŠå®ƒä»¬å„è‡ªçš„åŠŸèƒ½è¯´æ˜ï¼š

Project/
â”œâ”€â”€ .git/                     # Git ç‰ˆæœ¬æ§åˆ¶ç›®å½•
â”œâ”€â”€ .gitignore                # Git å¿½ç•¥æ–‡ä»¶é…ç½®
â”œâ”€â”€ .gitattributes            # Git LFS è·Ÿè¸ªé…ç½®
â”œâ”€â”€ Frontend/                 # å‰ç«¯ä»£ç  (Vue/React/etc. - ç‹¬ç«‹é¡¹ç›®)
â”‚   â”œâ”€â”€ node_modules/         # å‰ç«¯ä¾èµ–
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ src/                  # å‰ç«¯æºä»£ç 
â”‚   â”œâ”€â”€ package.json          # å‰ç«¯é¡¹ç›®é…ç½®ä¸ä¾èµ–
â”‚   â””â”€â”€ ...                   # å…¶ä»–å‰ç«¯é…ç½®æ–‡ä»¶ (vite.config.js, etc.)
â”œâ”€â”€ django_apps/              # Django åº”ç”¨ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ search/               # æ ¸å¿ƒæœç´¢ä¸ RAG åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ admin.py          # Django Admin é…ç½®
â”‚   â”‚   â”œâ”€â”€ apps.py           # åº”ç”¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ crawler.py        # RedNote çˆ¬è™«å®ç° (Selenium)
â”‚   â”‚   â”œâ”€â”€ models.py         # æ•°æ®åº“æ¨¡å‹å®šä¹‰ (RedditContent, RednoteContent, ContentIndex ç­‰)
â”‚   â”‚   â”œâ”€â”€ views.py          # Django è§†å›¾ (å¤„ç† /search, /index_content ç­‰è¯·æ±‚)
â”‚   â”‚   â”œâ”€â”€ urls.py           # URL è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ utils.py          # å®ç”¨å·¥å…·å‡½æ•° (å¦‚ get_embeddings)
â”‚   â”‚   â”œâ”€â”€ tests.py          # åº”ç”¨æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ index_service/    # ç´¢å¼•ä¸æ£€ç´¢æœåŠ¡æ ¸å¿ƒé€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py         # IndexService ç±» (æ•´åˆå…¥å£)
â”‚   â”‚   â”‚   â”œâ”€â”€ faiss_manager.py  # FAISS å’Œ BM25 ç´¢å¼•ç®¡ç† (ç©ºç´¢å¼•åº“åˆå§‹åŒ–ï¼Œç´¢å¼•åŠ è½½ã€ä¿å­˜ã€æœç´¢)
â”‚   â”‚   â”‚   â”œâ”€â”€ indexer.py        # å†…å®¹ç´¢å¼•å™¨ (Embedding ç”Ÿæˆã€å†™å…¥ FAISS å’Œ ContentIndex)
â”‚   â”‚   â”‚   â”œâ”€â”€ hybrid_retriever.py # æ··åˆæ£€ç´¢å™¨ (ç»“åˆkey words score(BM25), embedding score, Votes/Likes Score, å½’ä¸€åŒ–ååˆå¹¶æ’åº)
â”‚   â”‚   â”‚   â”œâ”€â”€ result_processor.py # ç»“æœå¤„ç†å™¨ (ç‰¹åˆ«æ˜¯æ¨èç±»æŸ¥è¯¢çš„æ’åºå’Œæ ¼å¼åŒ–)
â”‚   â”‚   â”‚   â”œâ”€â”€ rating_processor.py # æƒ…æ„Ÿ/è¯„åˆ†å¤„ç†å™¨ (ç”¨äºæ¨èæ’åº)
â”‚   â”‚   â”‚   â””â”€â”€ text_preprocessor.py # æ–‡æœ¬é¢„å¤„ç†å™¨ (ç”¨äº BM25 ç­‰)
â”‚   â”‚   â”œâ”€â”€ management/       # Django ç®¡ç†å‘½ä»¤
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ commands/
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â”œâ”€â”€ test_rednote_crawler.py # è¿è¡Œ RedNote çˆ¬è™«çš„å‘½ä»¤
â”‚   â”‚   â”‚       â”œâ”€â”€ initialize_index.py    # (å·²å¼ƒç”¨) åˆå§‹åŒ–ç´¢å¼•å‘½ä»¤
â”‚   â”‚   â”‚       â”œâ”€â”€ index_content.py       # (å·²å¼ƒç”¨) ç´¢å¼•å†…å®¹å‘½ä»¤
â”‚   â”‚   â”‚       â”œâ”€â”€ test_data_generator.py # ç”Ÿæˆæµ‹è¯•æ•°æ®
â”‚   â”‚   â”‚       â””â”€â”€ test_rag.py            # RAG åŠŸèƒ½æµ‹è¯•å‘½ä»¤
â”‚   â”‚   â””â”€â”€ migrations/       # æ•°æ®åº“ç»“æ„å˜æ›´è®°å½•
â”‚   â”‚       â””â”€â”€ ...
â”‚   â””â”€â”€ memory/               # å¯¹è¯è®°å¿†ç®¡ç†åº”ç”¨
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ models.py         # å¯¹è¯è®°å¿†æ¨¡å‹
â”‚       â”œâ”€â”€ service.py        # è®°å¿†å­˜å‚¨ä¸è¯»å–æœåŠ¡
â”‚       â””â”€â”€ ...
â”œâ”€â”€ search_process/           # RAG æµç¨‹ä¸­ä¸ LLM äº¤äº’ç›¸å…³çš„å¤„ç†é€»è¾‘
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ prompt_generator/     # Prompt ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ generator.py      # æ„å»ºå‘é€ç»™ LLM çš„å®Œæ•´ Prompt
â”‚   â”œâ”€â”€ query_classification/ # æŸ¥è¯¢åˆ†ç±»
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ classification.py # ä½¿ç”¨ LLM åˆ¤æ–­æŸ¥è¯¢ç±»å‹
â”‚   â”œâ”€â”€ langchain_parser.py   # è§£æ LangChain/LLM è¿”å›ç»“æœ
â”‚   â””â”€â”€ prompt_sender.py      # å‘é€ Prompt ç»™ LLM (Gemini)
â”œâ”€â”€ faiss_index/              # FAISS ç´¢å¼•å­˜å‚¨ç›®å½• (Git LFS è·Ÿè¸ª)
â”‚   â”œâ”€â”€ reddit/
â”‚   â”‚   â”œâ”€â”€ index.faiss (åœ¨ä¸‹æ–¹â€œRAGæ¨¡å—/ç´¢å¼•æ„å»ºä¸å­˜å‚¨â€éƒ¨åˆ†å…·ä½“ä»‹ç»)
â”‚   â”‚   â””â”€â”€ index.pkl
â”‚   â”œâ”€â”€ stackoverflow/
â”‚   â”‚   â”œâ”€â”€ index.faiss
â”‚   â”‚   â””â”€â”€ index.pkl
â”‚   â””â”€â”€ rednote/
â”‚       â”œâ”€â”€ index.faiss
â”‚       â””â”€â”€ index.pkl
â”œâ”€â”€ venv/                     # Python è™šæ‹Ÿç¯å¢ƒ (ä¸åœ¨ Git ä¸­)
â”œâ”€â”€ .env                      # ç¯å¢ƒå˜é‡ (å¦‚ API Key, ä¸åœ¨ Git ä¸­)
â”œâ”€â”€ db.sqlite3                # SQLite æ•°æ®åº“æ–‡ä»¶ (Git LFS è·Ÿè¸ª)
â”œâ”€â”€ manage.py                 # Django é¡¹ç›®ç®¡ç†è„šæœ¬
â”œâ”€â”€ requirements.txt          # Python ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ set_api_key.py            # è®¾ç½® API Key çš„è„šæœ¬
â”œâ”€â”€ README.md                 # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â””â”€â”€ diagram.dot               # Graphviz æµç¨‹å›¾å®šä¹‰æ–‡ä»¶







3ï¼Œå‰ç«¯ï¼š

Chinese version:
1. ç›®å½•ç»“æ„
Frontend/ â€“ Vite + Reactï¼ˆTypeScriptï¼‰å•é¡µåº”ç”¨
src/pages/SummaryPage.tsx â€“ èŠå¤©å¼æœç´¢ç•Œé¢ï¼ˆä¼šè¯ã€æ¨¡æ¿ã€è‡ªåŠ¨æ»šåŠ¨ï¼‰
src/components/Sidebar.tsx â€“ æ¨¡å‹ / å¹³å°é€‰æ‹©å™¨ + èŠå¤©åˆ—è¡¨ + ä¼šè¯æŒä¹…åŒ–
src/components/QuestionTemplates.tsx â€“ åŠ¨æ€æç¤ºé¢æ¿ï¼Œæ˜¾ç¤ºåœ¨è¾“å…¥æ¡†ä¸Šæ–¹ï¼Œå¤±ç„¦åå»¶è¿Ÿéšè—
src/lib/session.ts â€“ è´Ÿè´£è·å– / ç¼“å­˜ sessionid cookieï¼Œå¹¶åœ¨æ¯æ¬¡ fetch æ—¶è‡ªåŠ¨æºå¸¦
vite.config.ts â€“ å°† /api ä»£ç†åˆ° Django(8000)ï¼Œå¼€å‘é˜¶æ®µæ—  CORS çƒ¦æ¼

2. æ„å»º & æœ¬åœ°è°ƒè¯•
cd Frontend
npm install        # å®‰è£… React / Vite / Tailwind ç­‰ä¾èµ–
npm run dev        # å¯åŠ¨çƒ­æ›´æ–° http://localhost:5173
npm run build      # ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…ï¼Œè¾“å‡ºåˆ° Frontend/dist

3. ç½‘ç»œçº¦å®š
æ‰€æœ‰è¯·æ±‚å‡èµ° /api/*ï¼Œç”± Vite åå‘ä»£ç†
è®¤è¯åªç”¨ cookieï¼š
fetch("/api/search/", {
  method: "POST",
  credentials: "include",      // å…³é”®ï¼šå‘é€å¹¶æ¥æ”¶ sessionid
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ ... })
})
SPA é¦–æ¬¡åŠ è½½ä¼šè®¿é—® /api/sessionKey/ï¼›Django è¿”å›çš„ Set-Cookie: sessionid=... ä¹‹åè‡ªåŠ¨éšè¯·æ±‚å‘é€

4. çŠ¶æ€æµç¨‹
Sidebar è§¦å‘ newChat(platform) â†’ React Context æŠŠ {chatId, platform, messages: []} å­˜åˆ° localStorage
SummaryPage æ¸²æŸ“å½“å‰ä¼šè¯
ç”¨æˆ·æäº¤ â†’ onUpdateMessages("User: ...") â†’ fetch â†’ onUpdateMessages("Bot: ...")
æ¯æ¬¡æœç´¢ç»“æŸåï¼Œå†æ‹‰å– /api/getMemory/ è¡¥å…¨å†å²


5. äº¤äº’ç»†èŠ‚
æ–°æ¶ˆæ¯å è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨ï¼›åˆ‡æ¢ä¼šè¯æ—¶æ»šåˆ°é¡¶éƒ¨
QuestionTemplates ç»å¯¹å®šä½åœ¨è¾“å…¥æ¡†ä¸Šæ–¹ï¼›æ— æ¨¡æ¿æ—¶ç›´æ¥éšè—
æ ·å¼é‡‡ç”¨ Tailwindï¼Œmax-w-screen-lg mx-auto ä¿è¯æœç´¢æ  & æ¶ˆæ¯å®½åº¦å§‹ç»ˆ 100%
æ‰€æœ‰æŒ‰é’®ä¸è¾“å…¥æ¡†å‡å¸¦ aria-labelï¼Œæ·±è‰²æ¨¡å¼è‡ªåŠ¨é€‚é…


### 6. æ ·å¼ & ä¸»é¢˜ï¼ˆå¦‚ä½•å¿«é€Ÿæ”¹ UIï¼‰

#### 6.1 Tailwind å…¥å£
æ‰€æœ‰å…¨å±€æ ·å¼é›†ä¸­åœ¨ `Frontend/src/index.css`  
Tailwind åœ¨ `tailwind.config.ts` é‡Œåšäº†ä¸¤ä»¶äº‹ï¼š
1. è®¾å®šè”šè“ï¼ˆ`primary`ï¼‰å’Œé’ç»¿ï¼ˆ`accent`ï¼‰ä¸¤ç§ä¸»è‰²ï¼›
2. å¼€å¯ `darkMode:"class"`â€”â€”ç»™ `<html class="dark">` å³å¯è¿›å…¥æ·±è‰²æ¨¡å¼ã€‚

#### 6.2 ä¿®æ”¹å®½åº¦ / æ’ç‰ˆ
ç»„ä»¶é‡Œå‡¡æ˜¯å‡ºç°  
```tsx
<div className="max-w-screen-lg mx-auto px-4">
max-w-screen-lg æ§åˆ¶æœ€å¤§å®½åº¦ï¼Œå¯æ”¹æˆ max-w-screen-xl æˆ–ç§»é™¤è®©å…¶ 100% å®½
px-4 æ§åˆ¶å·¦å³å†…è¾¹è·ï¼Œå•ä½ 1 = 0.25rem

6.3 æ”¹å˜æœç´¢æ ä½ç½® / æ ·å¼
æœç´¢æ ä½äº SummaryPage.tsxï¼š
<form className="sticky bottom-0 bg-white dark:bg-zinc-900 ...">

æŠŠ sticky bottom-0 æ¢æˆ fixed bottom-4 left-1/2 -translate-x-1/2 å¯æ‚¬æµ®åœ¨é¡µé¢åº•éƒ¨
åŠ  shadow-lg rounded-full å°±èƒ½å¾—åˆ°åœ†è§’æµ®çª—æ•ˆæœ


6.4 è°ƒæ•´èŠå¤©æ°”æ³¡
ChatBubble ç»„ä»¶ï¼ˆä½äº src/components/ChatBubble.tsxï¼‰ï¼š
<div className={`p-3 rounded-lg ${isUser ? "bg-primary-500 text-white ml-auto" : "bg-zinc-200"}`}>

æ”¹ bg-primary-500 => bg-rose-500 å¯æŠŠç”¨æˆ·æ°”æ³¡æ”¹æˆç²‰è‰²
åŠ å…¥ prose ç±»è®© Markdown è‡ªåŠ¨æ’ç‰ˆ


6.5 æ–°å¢ä¸»é¢˜
åœ¨ tailwind.config.ts:
theme: {
  extend: {
    colors: {
      brand: {  DEFAULT:"#188a8d",  light:"#34c8cc" },
    }
  }
}
ç„¶åç»„ä»¶é‡Œç›´æ¥å†™ bg-brand / hover:bg-brand-light å³å¯ã€‚
Tipï¼šä¿®æ”¹å®Œ tailwind.config.ts éœ€é‡å¯ npm run dev æ‰ä¼šç”Ÿæ•ˆã€‚
```

4ï¼Œåç«¯ï¼š

# åç«¯search.views.pyè°ƒç”¨é¡ºåº

#### **æ­¥éª¤ 1: æ¥æ”¶è¯·æ±‚å’Œæ—¥å¿—è®°å½•**
- **è¾“å…¥**: è¯·æ±‚ä½“ï¼ˆ`request.body`ï¼‰ä¸­åŒ…å«äº†`search_query`ï¼ˆæœç´¢æŸ¥è¯¢ï¼‰ï¼Œ`source`ï¼ˆå¹³å°ï¼Œå¦‚'reddit'ï¼‰ï¼Œ`filter_value`ï¼ˆè¿‡æ»¤æ¡ä»¶ï¼‰ï¼Œ`llm_model`ï¼ˆæ¨¡å‹ç±»å‹ï¼‰ï¼Œ`session_id`ï¼ˆä¼šè¯IDï¼‰ç­‰æ•°æ®ã€‚
- **æ–¹æ³•**: 
  - `json.loads(request.body.decode('utf-8'))` ç”¨æ¥è§£æè¯·æ±‚ä½“ä¸­çš„ JSON æ•°æ®ã€‚
  - `logger.info()`ã€`logger.debug()` ç”¨äºæ—¥å¿—è®°å½•ï¼Œå¸®åŠ©è°ƒè¯•å’Œè·Ÿè¸ªè¯·æ±‚ã€‚

#### **æ­¥éª¤ 2: è·å–æœ€è¿‘çš„è®°å¿†**
- **è¾“å…¥**: `session_id`ã€`platform` å’Œ `topic`ï¼ˆä»è¯·æ±‚ä¸­è·å–ï¼‰ã€‚
- **æ–¹æ³•**: 
  - `MemoryService.get_recent_memory(session_id, limit=10, platform=platform, topic=topic)` è·å–æœ€è¿‘çš„è®°å¿†ã€‚è¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªåŒ…å«ä¼šè¯ç›¸å…³è®°å¿†çš„åˆ—è¡¨ã€‚

#### **æ­¥éª¤ 3: FAISS ç›¸ä¼¼æ–‡æ¡£æ£€ç´¢**
- **è¾“å…¥**: `search_query`ï¼ˆæœç´¢æŸ¥è¯¢ï¼‰å’Œ `platform`ï¼ˆå¹³å°ï¼‰ï¼Œå¹³å°çš„é€‰æ‹©é»˜è®¤æ˜¯'reddit'ã€‚
- **æ–¹æ³•**:
  - `index_service.faiss_manager.get_index_size()` è·å–å½“å‰ç´¢å¼•çš„å¤§å°ã€‚
  - `HybridRetriever.retrieve(query=search_query, top_k=10, relevance_threshold=0.6)` ä½¿ç”¨ FAISS ç´¢å¼•å’Œ BM25 ç®—æ³•è¿›è¡Œæœç´¢ï¼Œè¿”å›ç›¸ä¼¼æ–‡æ¡£ã€‚

#### **æ­¥éª¤ 4: åˆ†ç±»æŸ¥è¯¢ç±»å‹**
- **è¾“å…¥**: `search_query`ï¼ˆæœç´¢æŸ¥è¯¢ï¼‰ï¼Œ`llm_model`ï¼ˆæ¨¡å‹ç±»å‹ï¼‰ã€‚
- **æ–¹æ³•**:
  - `classify_query(search_query, llm_model)` è¯†åˆ«æŸ¥è¯¢ç±»å‹ï¼ˆå¦‚æ¨èç±»æŸ¥è¯¢ï¼‰ï¼Œè¿”å›åˆ†ç±»ç»“æœã€‚é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æå–åˆ†ç±»IDã€‚
  - ä½¿ç”¨ `re.search(r">(\d+)<", ...)` æå–åˆ†ç±»IDã€‚

#### **æ­¥éª¤ 5: æ ¹æ®æŸ¥è¯¢ç±»å‹é€‰æ‹©å¤„ç†é€»è¾‘**
- **æ¨èç±»æŸ¥è¯¢å¤„ç†**:
  - **è¾“å…¥**: `retrieved_docs`ï¼ˆæ£€ç´¢åˆ°çš„æ–‡æ¡£ï¼‰ï¼Œ`search_query`ï¼ˆæœç´¢æŸ¥è¯¢ï¼‰ã€‚
  - **æ–¹æ³•**:
    - `index_service.result_processor.process_recommendations()` å¤„ç†æ¨èé€»è¾‘ï¼Œè¿”å›æ¨èçš„æ–‡æ¡£ã€‚
    - `format_recommendation_results()` æ ¼å¼åŒ–æ¨èç»“æœï¼Œç”Ÿæˆæ–‡æœ¬å½¢å¼çš„æ¨èç»“æœã€‚
    - `MemoryService.add_to_memory(session_id, search_query, answer)` å°†æ¨èç»“æœä¿å­˜åˆ°è®°å¿†ä¸­ã€‚
  
  å¦‚æœæ˜¯æ¨èç±»æŸ¥è¯¢ï¼Œåˆ™ç›´æ¥è¿”å›æ ¼å¼åŒ–çš„æ¨èç»“æœï¼Œå¹¶æ ‡è®°`llm_model`ä¸º"recommendation_processor"ã€‚

- **éæ¨èç±»æŸ¥è¯¢å¤„ç†**:
  - **è¾“å…¥**: `search_query`ï¼ˆæœç´¢æŸ¥è¯¢ï¼‰ï¼Œ`retrieved_docs`ï¼ˆæ£€ç´¢åˆ°çš„æ–‡æ¡£ï¼‰ï¼Œ`recent_memory`ï¼ˆæœ€è¿‘çš„è®°å¿†ï¼‰ã€‚
  - **æ–¹æ³•**:
    - `generate_prompt()` ç”Ÿæˆç”¨äº LLMï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰çš„æç¤ºï¼ˆpromptï¼‰ã€‚
    - `send_prompt()` é€šè¿‡çº¿ç¨‹æ± å¼‚æ­¥å‘é€è¯·æ±‚åˆ° LLM æœåŠ¡ï¼Œè·å–å›ç­”ã€‚
    - `parse_langchain_response()` è§£æ LLM çš„å“åº”ï¼Œè·å–ç­”æ¡ˆå’Œå…ƒæ•°æ®ã€‚
    - `MemoryService.add_to_memory(session_id, search_query, answer)` ä¿å­˜å›ç­”åˆ°è®°å¿†ã€‚

#### **æ­¥éª¤ 6: è¿”å›æœç´¢ç»“æœ**
- **è¾“å…¥**: `answer`ï¼ˆæœç´¢å›ç­”ï¼‰ï¼Œ`metadata`ï¼ˆå…ƒæ•°æ®ï¼‰ï¼Œ`llm_model`ï¼ˆæ¨¡å‹ç±»å‹ï¼‰ï¼Œ`recent_memory`ï¼ˆæœ€è¿‘çš„è®°å¿†ï¼‰ã€‚
- **æ–¹æ³•**:
  - `JsonResponse()` è¿”å›JSONæ ¼å¼çš„å“åº”ï¼ŒåŒ…å«æœç´¢ç»“æœã€å…ƒæ•°æ®å’Œå†å²è®°å¿†ã€‚

---

# å‰åç«¯äº¤äº’APIæè¿°

## 1. è¯·æ±‚å¤„ç†å…¥å£ï¼š`search(request)`

### ğŸ”¸ å‰ç«¯å‘é€ï¼š
- **æ–¹æ³•**ï¼š`POST`
- **è·¯å¾„**ï¼šä¾‹å¦‚ `/search/`
- **è¯·æ±‚ä½“ï¼ˆBodyï¼‰ç¤ºä¾‹**ï¼š
```json
{
  "search_query": "å¦‚ä½•ä½¿ç”¨Pythonçˆ¬å–Redditæ•°æ®ï¼Ÿ",
  "source": "reddit",
  "filter_value": null,
  "llm_model": "gemini-pro",
  "session_id": "abc123",
  "topic": "pythonçˆ¬è™«"
}
```

### ğŸ”¸ åç«¯è¿”å›ï¼š
- **è¿”å›æ•°æ®ç¤ºä¾‹**ï¼š
```json
{
  "result": "æ ¹æ®æ‚¨çš„æŸ¥è¯¢ï¼Œä¸ºæ‚¨æ¨èä»¥ä¸‹å†…å®¹...",
  "metadata": {
    "query_type": "recommendation",
    "processing": "direct"
  },
  "llm_model": "recommendation_processor",
  "history": [...]
}
```

---

## 2. ä¼šè¯ç®¡ç†ç›¸å…³æ¥å£

### (1) è·å–æˆ–åˆ›å»ºSessionï¼š`sessionKey(request)`

- **æ–¹æ³•**ï¼š`POST`
- **è¿”å›æ•°æ®ç¤ºä¾‹**ï¼š
```json
{
  "session_id": "abc123"
}
```

---

### (2) è·å–æŒ‡å®šSessionçš„Memoryï¼š`getMemory(request)`

- **æ–¹æ³•**ï¼š`GET`
- **å‚æ•°**ï¼š
  - `session_id`
- **è¿”å›æ•°æ®ç¤ºä¾‹**ï¼š
```json
{
  "memory": [...]
}
```

---

### (3) è·å–å…¨éƒ¨SessionåŠå†å²å¯¹è¯ï¼š`getAllChat(request)`

- **æ–¹æ³•**ï¼š`GET`
- **è¿”å›æ•°æ®ç¤ºä¾‹**ï¼š
```json
{
  "sessions": [
    {
      "session_id": "abc123",
      "platform": "reddit",
      "topic": "pythonçˆ¬è™«",
      "memory_data": [...],
      "updated_at": "2025-04-26T12:30:45"
    },
    ...
  ]
}
```

---

# æŸ¥è¯¢åˆ†ç±»é€»è¾‘

- åç«¯é€šè¿‡ `classify_query(search_query, llm_model)` è¿”å›ä¸€ä¸ªå¸¦æœ‰åˆ†ç±»ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œæ ¼å¼ä¾‹å¦‚ï¼š
  ```
  ">1<"
  ```

- **åˆ†ç±»ç¼–ç å¯¹åº”è¡¨**ï¼š

| ç¼–å· | ç±»åˆ«åç§° |
| :--- | :--- |
| 1 | Recommendation classï¼ˆæ¨èç±»ï¼‰ |
| 2 | Knowledge interpretation classï¼ˆçŸ¥è¯†è§£è¯»ç±»ï¼‰ |
| 3 | Opinion Discussionï¼ˆè§‚ç‚¹è®¨è®ºç±»ï¼‰ |
| 4 | Operation instruction and tutorial method classï¼ˆæ“ä½œæŒ‡å¯¼ä¸æ•™ç¨‹æ–¹æ³•ç±»ï¼‰ |
| 5 | Specific scenariosï¼ˆç‰¹å®šåœºæ™¯ç±»ï¼‰ |
| 6 | Information and real-time dynamic classï¼ˆä¿¡æ¯ä¸å®æ—¶åŠ¨æ€ç±»ï¼‰ |




(2), æ•°æ®åº“ç»“æ„(æ¯ä¸ªè¡¨å•çš„ç»“æ„ã€è¡¨å¤´ã€å­˜å‚¨çš„æ•°æ®å†…å®¹)åŠç›¸å…³æ–‡ä»¶ä½ç½®
## æ•°æ®åº“è®¾è®¡

NextGen-AIé¡¹ç›®é‡‡ç”¨Django ORMæ¡†æ¶ç®¡ç†æ•°æ®åº“ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹æ•°æ®è¡¨å•ï¼Œå­˜å‚¨ä»ä¸åŒå¹³å°è·å–çš„å†…å®¹æ•°æ®ä»¥åŠç›¸å…³æ£€ç´¢ç´¢å¼•ä¿¡æ¯ã€‚
æ–‡ä»¶ä½äº`/django_apps/search/models.py`

### ä¸»è¦æ•°æ®è¡¨å•

#### ContentIndexè¡¨
æ­¤è¡¨ç”¨äºè·Ÿè¸ªå“ªäº›å†…å®¹å·²è¢«æˆåŠŸç´¢å¼•ï¼Œå­˜å‚¨äº†å†…å®¹çš„å”¯ä¸€æ ‡è¯†å’Œç´¢å¼•ç›¸å…³ä¿¡æ¯ï¼š
- `source`: æ•°æ®æ¥æºå¹³å°ï¼ˆå¦‚redditã€stackoverflowã€rednoteç­‰ï¼‰
- `thread_id`: å†…å®¹çš„å”¯ä¸€æ ‡è¯†ç¬¦
- `embedding_key`: å¯¹åº”FAISSç´¢å¼•ä¸­çš„å‘é‡æ ‡è¯†

#### RedditContentè¡¨
å­˜å‚¨ä»Redditå¹³å°æŠ“å–çš„å†…å®¹ï¼š
- `source`: å›ºå®šä¸º"reddit"
- `content_type`: å†…å®¹ç±»å‹ï¼Œå¦‚"post"
- `thread_id`: Redditå¸–å­çš„å”¯ä¸€ID
- `thread_title`: å¸–å­æ ‡é¢˜
- `url`: å¸–å­é“¾æ¥
- `author_name`: ä½œè€…ç”¨æˆ·å
- `content`: å¸–å­æ­£æ–‡ä¸è¯„è®ºå†…å®¹çš„ç»„åˆ
- `created_at`: åˆ›å»ºæ—¶é—´
- `subreddit`: å‘å¸ƒçš„å­ç‰ˆå—å
- `upvotes`: è·å¾—çš„ç‚¹èµæ•°

#### StackOverflowContentè¡¨
å­˜å‚¨ä»Stack Overflowå¹³å°æŠ“å–çš„é—®ç­”å†…å®¹ï¼š
- `source`: å›ºå®šä¸º"stackoverflow"
- `content_type`: å†…å®¹ç±»å‹ï¼Œå¦‚"question"
- `thread_id`: é—®é¢˜çš„å”¯ä¸€ID
- `thread_title`: é—®é¢˜æ ‡é¢˜
- `url`: é—®é¢˜é“¾æ¥
- `author_name`: æé—®è€…ç”¨æˆ·å
- `content`: é—®é¢˜æ­£æ–‡ã€è¯„è®ºåŠå›ç­”çš„ç»„åˆ
- `created_at`: åˆ›å»ºæ—¶é—´
- `tags`: é—®é¢˜æ ‡ç­¾ï¼Œä»¥é€—å·åˆ†éš”
- `vote_score`: é—®é¢˜çš„æŠ•ç¥¨å¾—åˆ†

#### RednoteContentè¡¨
å­˜å‚¨ä»å°çº¢ä¹¦ï¼ˆRedNoteï¼‰å¹³å°æŠ“å–çš„å†…å®¹ï¼š
- `source`: å›ºå®šä¸º"rednote"
- `content_type`: å†…å®¹ç±»å‹ï¼Œå¦‚"note"
- `thread_id`: ç¬”è®°çš„å”¯ä¸€ID
- `thread_title`: ç¬”è®°æ ‡é¢˜
- `url`: ç¬”è®°é“¾æ¥
- `author_name`: ä½œè€…ç”¨æˆ·å
- `content`: ç¬”è®°æ­£æ–‡å†…å®¹
- `created_at`: åˆ›å»ºæ—¶é—´
- `tags`: ç¬”è®°æ ‡ç­¾ï¼Œä»¥é€—å·åˆ†éš”
- `likes_count`: è·å¾—çš„ç‚¹èµæ•°



(3), æ•°æ®åº“ä¸­å†…å®¹çš„å­˜å‚¨æ–¹å¼ï¼š
API(Stackoverflow & Redditå¹³å°)ï¼š
#### Stack Overflowæ•°æ®è·å–
Stack Overflowæ•°æ®é€šè¿‡å®˜æ–¹APIè¿›è¡ŒæŠ“å–ï¼Œä¸»è¦å®ç°åœ¨`django_apps/search/stackoverflow_crawler.py`ä¸­ï¼š

1. **æŸ¥è¯¢æ–¹å¼**ï¼š
   - å…³é”®è¯æœç´¢ï¼šä½¿ç”¨Stack Exchange APIçš„`/search`ç«¯ç‚¹è¿›è¡Œé—®é¢˜æœç´¢
   - æ ‡ç­¾ç»„åˆæœç´¢ï¼šä½¿ç”¨`/questions`ç«¯ç‚¹é…åˆæ ‡ç­¾å‚æ•°è¿›è¡Œè¿‡æ»¤

2. **æ•°æ®å¤„ç†æµç¨‹**ï¼š
   - åˆå§‹åŒ–`StackOverflowFetcher`ç±»ï¼Œè®¾ç½®APIå‚æ•°ï¼ˆå¦‚æ’åºæ–¹å¼ã€æ¯é¡µæ•°é‡ï¼‰
   - æ‰§è¡Œé—®é¢˜æœç´¢ï¼ˆ`search_questions`æ–¹æ³•ï¼‰è·å–é—®é¢˜åˆ—è¡¨
   - å¯¹æ¯ä¸ªé—®é¢˜è·å–è¯„è®ºï¼ˆ`fetch_comments_for_question`æ–¹æ³•ï¼‰
   - å¯¹æ¯ä¸ªé—®é¢˜è·å–å›ç­”ï¼ˆ`fetch_answers_for_question`æ–¹æ³•ï¼‰ï¼Œä¼˜å…ˆæ’åºå·²æ¥å—ç­”æ¡ˆ
   - ç»„åˆé—®é¢˜ã€è¯„è®ºå’Œç­”æ¡ˆæ„å»ºå®Œæ•´å†…å®¹
   - å°†å†…å®¹å­˜å‚¨åˆ°`StackOverflowContent`è¡¨ä¸­

3. **æ•°æ®å¤šæ ·æ€§ç­–ç•¥**ï¼š
   - ä»JSONé…ç½®æ–‡ä»¶åŠ è½½å¤šæ ·åŒ–æŸ¥è¯¢å’Œæ ‡ç­¾ç»„åˆ
   - ä½¿ç”¨æ ‡ç­¾ç»„åˆï¼ˆå¦‚"python+django"ã€"javascript+react"ç­‰ï¼‰å¢åŠ å†…å®¹å¤šæ ·æ€§
   - æŒ‰ä¸åŒæ’åºæ–¹å¼ï¼ˆå¦‚æŒ‰æŠ•ç¥¨æ•°ã€æŒ‰æ´»è·ƒåº¦ï¼‰è·å–å†…å®¹

#### Redditæ•°æ®è·å–
Redditæ•°æ®é€šè¿‡PRAWï¼ˆPython Reddit API Wrapperï¼‰è·å–ï¼Œä¸»è¦å®ç°åœ¨`django_apps/search/reddit_crawler.py`ä¸­ï¼š

1. **æŸ¥è¯¢æ–¹å¼**ï¼š
   - ä½¿ç”¨`subreddit.search`æ–¹æ³•è¿›è¡Œå…³é”®è¯æœç´¢
   - æ”¯æŒè·¨æ‰€æœ‰å­ç‰ˆå—ï¼ˆsubreddit="all"ï¼‰çš„ç»¼åˆæœç´¢

2. **æ•°æ®å¤„ç†æµç¨‹**ï¼š
   - åˆå§‹åŒ–Reddit APIå®¢æˆ·ç«¯ï¼ˆ`create_reddit_instance`å‡½æ•°ï¼‰
   - æ‰§è¡Œå…³é”®è¯æœç´¢è·å–å¸–å­åˆ—è¡¨
   - å¯¹æ¯ä¸ªå¸–å­è·å–è¯„è®ºï¼ˆ`fetch_comments_for_post`å‡½æ•°ï¼‰ï¼ŒæŒ‰ç‚¹èµæ•°æ’åº
   - ç»„åˆå¸–å­æ­£æ–‡å’Œè¯„è®ºæ„å»ºå®Œæ•´å†…å®¹
   - å°†å†…å®¹å­˜å‚¨åˆ°`RedditContent`è¡¨ä¸­

3. **æ•°æ®è´¨é‡ä¿éšœ**ï¼š
   - è®°å½•æ—¶ä¿ç•™å¸–å­åŸå§‹æ—¶é—´æˆ³ï¼Œä½¿ç”¨Pythonçš„`timezone.utc`ç¡®ä¿æ—¶åŒºä¸€è‡´
   - è®°å½•å¸–å­æŠ•ç¥¨åˆ†æ•°ï¼ˆupvotesï¼‰ï¼Œä¸ºåç»­æ£€ç´¢æ’åºæä¾›å‚è€ƒ
   - æ·»åŠ è¯·æ±‚é—´éš”ï¼ˆ`time.sleep`ï¼‰é¿å…è§¦å‘APIé™åˆ¶




çˆ¬è™«(Rednoteå¹³å°)ï¼š
## RedNote çˆ¬è™«

RedNote (å°çº¢ä¹¦) çˆ¬è™«åˆ©ç”¨ `Selenium` åŠå…¶åæ£€æµ‹æ‰©å±• `selenium-stealth` æ¥æ¨¡æ‹Ÿæµè§ˆå™¨è¡Œä¸ºï¼ŒæŠ“å–æŒ‡å®š URL é¡µé¢çš„ç¬”è®°å†…å®¹ã€‚

-   **æ ¸å¿ƒå®ç°**:
    -   **ä¸»è¦é€»è¾‘**: ä½äº `django_apps/search/crawler.py` æ–‡ä»¶ä¸­çš„ `crawl_rednote_page` å‡½æ•°ã€‚è¯¥å‡½æ•°è´Ÿè´£ï¼š
        1.  **åˆå§‹åŒ– WebDriver**: é…ç½® `Selenium WebDriver` (Chrome)ï¼Œåº”ç”¨ `selenium-stealth` è®¾ç½®ä»¥é¿å…è¢«æ£€æµ‹ï¼Œå¹¶å¤„ç†ç‰¹å®šå¹³å°ï¼ˆå¦‚ macOS ARMï¼‰çš„ `ChromeDriver` è·¯å¾„ã€‚
        2.  **ç™»å½•**: æ³¨å…¥æä¾›çš„ `cookies` (ç›®å‰ç¡¬ç¼–ç åœ¨ç®¡ç†å‘½ä»¤ä¸­) ä»¥æ¨¡æ‹Ÿç™»å½•çŠ¶æ€ã€‚
        3.  **é¡µé¢åŠ è½½ä¸æ»šåŠ¨**: æ‰“å¼€ç›®æ ‡ URLï¼Œæ¨¡æ‹Ÿäººç±»å‘ä¸‹æ»šåŠ¨ (`human_like_scroll`) ä»¥åŠ¨æ€åŠ è½½æ›´å¤šç¬”è®°ã€‚
        4.  **ç¬”è®°éå†**: æŸ¥æ‰¾é¡µé¢ä¸Šçš„ç¬”è®°é“¾æ¥ (`a.cover.ld.mask`)ï¼Œå¹¶é™åˆ¶å¤„ç†æ•°é‡ï¼ˆ`MAX_POSTS`ï¼‰ã€‚
        5.  **æ•°æ®æå–**: å¯¹æ¯ä¸ªç¬”è®°é“¾æ¥ï¼š
            -   å®‰å…¨ç‚¹å‡»è¿›å…¥ç¬”è®°è¯¦æƒ…é¡µ (`safe_click_by_selector`)ã€‚
            -   æå–ç¬”è®°æ ‡é¢˜ã€æ­£æ–‡å†…å®¹ (`div.note-content`)ã€ä½œè€…ã€å‘å¸ƒæ—¥æœŸã€ç‚¹èµæ•°ã€æ ‡ç­¾ç­‰ä¿¡æ¯ã€‚
            -   è§£ææ—¥æœŸ (`parse_xiaohongshu_date`) å’Œç‚¹èµæ•° (`parse_likes_count`) ä¸ºæ ‡å‡†æ ¼å¼ã€‚
        6.  **æ•°æ®åº“äº¤äº’**:
            -   **æŸ¥é‡**: ä½¿ç”¨ç¬”è®° URL ä¸­çš„å”¯ä¸€ ID (`thread_id`) åœ¨ `RednoteContent` è¡¨ä¸­æŸ¥æ‰¾æ˜¯å¦å·²å­˜åœ¨è®°å½•ã€‚
            -   **æ›´æ–°**: å¦‚æœè®°å½•å·²å­˜åœ¨ä¸”**å°šæœªè¢«ç´¢å¼•** (ç›®å‰è¿˜æ²¡æœ‰å®ç°ï¼Œåº”è¯¥æ ¹æ®ContentIndexä¸­æ˜¯å¦æœ‰ç›¸åŒthread_idçš„æ•°æ®æ¥åˆ¤æ–­æ˜¯å¦è¢«ç´¢å¼•è¿‡)ï¼Œåˆ™æ›´æ–°å…¶å…ƒæ•°æ®ï¼ˆæ ‡é¢˜ã€ä½œè€…ã€ç‚¹èµæ•°ç­‰ï¼‰ã€‚å¦‚æœå·²è¢«ç´¢å¼•ï¼Œåˆ™è·³è¿‡ã€‚
            -   **åˆ›å»º**: å¦‚æœè®°å½•ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°çš„ `RednoteContent` æ¡ç›®ï¼Œå¹¶å°†æŠ“å–åˆ°çš„**å®Œæ•´ `content` å­˜å…¥æ•°æ®åº“**ã€‚
        7.  **å³æ—¶ç´¢å¼• (å¯é€‰)**: å¦‚æœ `--immediate-indexing` æ ‡å¿—è¢«æ¿€æ´»ï¼Œå°†æ–°åˆ›å»ºæˆ–å¾…æ›´æ–°çš„æ•°æ®åº“å¯¹è±¡ (`db_obj`) åŠå…¶æ–‡æœ¬å†…å®¹ (`content_text`) åŠ å…¥å¾…å¤„ç†åˆ—è¡¨ã€‚
        8.  **è¿”å›åˆ—è¡¨**: çˆ¬è™«ç»“æŸåï¼Œè¿”å›æ–°åˆ›å»ºçš„ `RednoteContent` å¯¹è±¡åˆ—è¡¨ã€‚
    -   **ç®¡ç†å‘½ä»¤**: ä½äº `django_apps/search/management/commands/test_rednote_crawler.py`ï¼Œæä¾›äº† `test_rednote_crawler` å‘½ä»¤ï¼Œç”¨äºæ¥æ”¶ URL å’Œ `--immediate-indexing` å‚æ•°ï¼Œå¹¶è°ƒç”¨ `crawl_rednote_page`ã€‚

-   **è¿è¡Œæ¨¡å¼**:
    1.  **å­˜å‚¨æ¨¡å¼ (é»˜è®¤)**:
        -   æ‰§è¡Œå‘½ä»¤: `python manage.py test_rednote_crawler --url "å°çº¢ä¹¦æŸå†…å®¹URL"`
        -   é€»è¾‘: ä»…æ‰§è¡Œä¸Šè¿°**æ ¸å¿ƒå®ç°**ä¸­çš„æ•°æ®æå–å’Œæ•°æ®åº“äº¤äº’ï¼ˆåˆ›å»ºæˆ–æ›´æ–°è®°å½•ï¼‰ï¼Œ**ç¡®ä¿ `content` å­—æ®µåŒ…å«æŠ“å–åˆ°çš„æ–‡æœ¬**ã€‚æ­¤æ¨¡å¼ä¸‹**ä¸è¿›è¡Œ** Embedding ç”Ÿæˆæˆ– FAISS ç´¢å¼•æ“ä½œã€‚é€‚ç”¨äºå…ˆæ‰¹é‡æŠ“å–ï¼Œåç»­ç»Ÿä¸€ç´¢å¼•çš„åœºæ™¯ã€‚
    2.  **å³æ—¶ç´¢å¼•æ¨¡å¼**:
        -   æ‰§è¡Œå‘½ä»¤: `python manage.py test_rednote_crawler --url "ä½ çš„å°çº¢ä¹¦URL" --immediate-indexing`
        -   é€»è¾‘: åœ¨**æ ¸å¿ƒå®ç°**çš„åŸºç¡€ä¸Šï¼Œå½“ä¸€ä¸ªç¬”è®°è¢«åˆ›å»ºæˆ–ç¡®å®šéœ€è¦æ›´æ–°ï¼ˆå› ä¸ºå®ƒä¹‹å‰æœªè¢«ç´¢å¼•ï¼‰åï¼š
            -   è¯¥ç¬”è®°å¯¹è±¡å’Œå…¶æ–‡æœ¬å†…å®¹ä¼šè¢«æš‚å­˜ã€‚
            -   åœ¨çˆ¬å–å¾ªç¯ç»“æŸåï¼Œç³»ç»Ÿä¼šéå†æ‰€æœ‰æš‚å­˜çš„ç¬”è®°ã€‚
            -   å¯¹æ¯ä¸ªç¬”è®°è°ƒç”¨ `index_service.indexer.index_crawled_item` å‡½æ•°ï¼ˆè¯¥å‡½æ•°ç”±çˆ¬è™«æ¨¡å—å†…åˆå§‹åŒ–çš„å…¨å±€ `index_service` å®ä¾‹æä¾›ï¼‰ã€‚
            -   `index_crawled_item` å†…éƒ¨ä¼š:
                -   è°ƒç”¨ Embedding æ¨¡å‹ç”Ÿæˆæ–‡æœ¬å†…å®¹çš„å‘é‡ã€‚
                -   å°†å‘é‡ã€æ–‡æœ¬å’Œå…ƒæ•°æ®æ·»åŠ åˆ°å†…å­˜ä¸­çš„ FAISS ç´¢å¼•ã€‚
                -   ä¸ºæ•°æ®åº“ä¸­çš„ç¬”è®°å¯¹è±¡è®¾ç½® `embedding_key` (ç›®å‰æ˜¯ UUID)ã€‚
                -   **å°†æ•°æ®åº“ä¸­è¯¥ç¬”è®°çš„ `content` å­—æ®µè®¾ç½®ä¸ºç©º (`None`)** ä»¥èŠ‚çœç©ºé—´ã€‚
                -   åœ¨ `ContentIndex` è¡¨ä¸­åˆ›å»ºä¸€æ¡è®°å½•ï¼Œæ ‡è®°è¯¥ç¬”è®°å·²è¢«ç´¢å¼•ã€‚
            -   æ‰€æœ‰ç¬”è®°å¤„ç†å®Œæ¯•åï¼Œè°ƒç”¨ `index_service.faiss_manager.save_index()` å°†å†…å­˜ä¸­çš„ FAISS ç´¢å¼•ï¼ˆåŒ…æ‹¬æ–°å¢çš„ Embeddingsï¼‰å’Œå…ƒæ•°æ®å˜æ›´**ä¸€æ¬¡æ€§ä¿å­˜åˆ°ç£ç›˜** (`index.faiss` å’Œ `index.pkl`)ã€‚

-   **æ‰¹é‡ç´¢å¼• (çˆ¬å–å)**: å¯¹äºä½¿ç”¨**å­˜å‚¨æ¨¡å¼**æ”¶é›†çš„æ•°æ®ï¼ˆ`content` å­—æ®µæœ‰å€¼ï¼Œ`embedding_key` ä¸ºç©ºï¼‰ï¼Œå¯ä»¥é€šè¿‡æ ‡å‡†çš„ç´¢å¼• API ç«¯ç‚¹è¿›è¡Œåç»­çš„æ‰¹é‡ç´¢å¼•ï¼š
    ```bash
    # å¯¹ rednote å¹³å°æ‰€æœ‰æœªè¢«ç´¢å¼•çš„å†…å®¹è¿›è¡Œç´¢å¼•
    curl -X POST http://localhost:8000/index_content/ -d "source=rednote"
    ```
    è¿™ä¸ªè¯·æ±‚ä¼šè§¦å‘ `views.py` ä¸­çš„ `index_content` é€»è¾‘ï¼ŒæŸ¥æ‰¾ `ContentIndex` ä¸­æ²¡æœ‰è®°å½•çš„ `RednoteContent` æ¡ç›®ï¼Œå¹¶å¯¹å…¶è¿›è¡Œ Embedding å’Œç´¢å¼•ï¼Œæœ€ç»ˆåŒæ ·ä¼šå°† `content` å­—æ®µæ¸…ç©ºã€‚

-   **ä¾èµ–ä¸è®¾ç½®**:
    -   éœ€è¦å®‰è£… `selenium`, `selenium-stealth`ã€‚
    -   éœ€è¦æ­£ç¡®é…ç½® `ChromeDriver` å¹¶ç¡®ä¿å…¶åœ¨ç³»ç»Ÿ PATH ä¸­å¯è®¿é—®ï¼ˆå…·ä½“å‚è€ƒä¸» README çš„çˆ¬è™«è®¾ç½®éƒ¨åˆ†ï¼Œæ³¨æ„ macOS ARM çš„ç‰¹æ®Šå¤„ç†å·²åœ¨ `crawler.py` ä¸­å®ç°ï¼‰ã€‚
    -   ç™»å½•æ‰€éœ€çš„ `Cookies` ç›®å‰**ç¡¬ç¼–ç **åœ¨ç®¡ç†å‘½ä»¤ `test_rednote_crawler.py` æ–‡ä»¶ä¸­ï¼Œå®é™…éƒ¨ç½²æˆ–å¤šäººåä½œæ—¶å¯èƒ½éœ€è¦æ”¹è¿›ä¸ºæ›´çµæ´»çš„é…ç½®æ–¹å¼ã€‚



(4), 

## RAG ç³»ç»Ÿ 

ä»¥ä¸‹å†…å®¹è¯¦ç»†ä»‹ç»æ£€ç´¢å¢å¼ºç”Ÿæˆ (Retrieval-Augmented Generation, RAG) æ¨¡å—ï¼ŒåŒ…æ‹¬ Embedding ç”Ÿæˆã€ç´¢å¼•æ„å»ºä¸ç®¡ç†ã€æ··åˆæ£€ç´¢æœºåˆ¶ä»¥åŠ Prompt æ„å»ºé€»è¾‘ã€‚

### Embedding ç”Ÿæˆ 

-   **æ¨¡å‹**: Embedding ä½¿ç”¨ `BAAI/bge-base-en` æ¨¡å‹ç”Ÿæˆï¼Œé€šè¿‡ `langchain_huggingface.HuggingFaceEmbeddings` åŒ…è£…å™¨è°ƒç”¨ã€‚
-   **å®ç°**: æ ¸å¿ƒ Embedding é€»è¾‘å°è£…åœ¨ `django_apps/search/utils.py` æ–‡ä»¶ä¸­çš„ `get_embeddings` å‡½æ•°ã€‚è¯¥å‡½æ•°åˆå§‹åŒ–æ¨¡å‹ï¼Œé…ç½®åœ¨å¯ç”¨æ—¶ä½¿ç”¨ CUDAï¼Œå¹¶è®¾ç½® `normalize_embeddings=True`ã€‚
-   **è¿‡ç¨‹**: `django_apps.search.index_service.indexer.Indexer` ç±»ä½¿ç”¨åˆå§‹åŒ–æ—¶ä¼ å…¥çš„ Embedding æ¨¡å‹å°†æ–‡æœ¬å†…å®¹è½¬æ¢ä¸ºå‘é‡ã€‚å…·ä½“æ¥è¯´ï¼Œ`_batch_create_embeddings` æ–¹æ³•åœ¨è°ƒç”¨ `self.embedding_model.embed_documents()` ä¹‹å‰å¤„ç†æ‰¹é‡æ–‡æœ¬å’Œé¢„å¤„ç†ï¼ˆå»é™¤ç©ºæ ¼ã€åŸºç¡€é•¿åº¦é™åˆ¶ï¼‰ã€‚


### ç´¢å¼•æ„å»ºä¸å­˜å‚¨

-   **å­˜å‚¨ç»“æ„ä¸å†…å®¹**:
    -   **ç‰©ç†ä½ç½®**: FAISS ç›¸å…³æ•°æ®æŒ‰å¹³å°å­˜å‚¨åœ¨ `faiss_index/` ç›®å½•ä¸‹çš„å­ç›®å½•ä¸­ï¼ˆä¾‹å¦‚ `faiss_index/reddit/`, `faiss_index/rednote/`ï¼‰ã€‚
    -   **æ ¸å¿ƒæ–‡ä»¶**: æ¯ä¸ªå¹³å°å­ç›®å½•ä¸‹åŒ…å«ä¸¤ä¸ªå…³é”®æ–‡ä»¶ï¼š
        1.  **`index.faiss`**:
            -   **å†…å®¹**: å­˜å‚¨ **FAISS ç´¢å¼•ç»“æ„æœ¬èº«** ä»¥åŠ **Embedding å‘é‡æ•°æ®**ã€‚FAISS ç´¢å¼•ç»“æ„æ˜¯ä¸€ç§ç»è¿‡ä¼˜åŒ–çš„æ•°æ®ç»“æ„ï¼Œç”¨äºæ ¹æ®è¾“å…¥çš„æŸ¥è¯¢å‘é‡å¿«é€Ÿæ‰¾åˆ°å­˜å‚¨åœ¨å…¶ä¸­çš„æœ€ç›¸ä¼¼çš„ Embedding å‘é‡ã€‚Embedding å‘é‡ï¼ˆç”±æ–‡æœ¬å†…å®¹è½¬æ¢è€Œæ¥ï¼‰æ˜¯æ„å»ºæ­¤ç´¢å¼•ç»“æ„çš„æ ¸å¿ƒæ•°æ®ï¼Œå¹¶ç›´æ¥åµŒå…¥åœ¨è¯¥æ–‡ä»¶å†…éƒ¨ï¼Œè€Œéå•ç‹¬å­˜æ”¾ã€‚
            -   **ç”¨é€”**: å®ç°é«˜æ•ˆçš„å‘é‡ç›¸ä¼¼æ€§æœç´¢ã€‚
        2.  **`index.pkl`**:
            -   **å†…å®¹**: å­˜å‚¨ä¸ `index.faiss` ä¸­æ¯ä¸ª Embedding å‘é‡ç›¸å¯¹åº”çš„**å…ƒæ•°æ® (Metadata)** å’Œ **æ˜ å°„å…³ç³» (Mapping)**ã€‚å…ƒæ•°æ®åŒ…æ‹¬æ–‡æ¡£çš„æ¥æºã€`thread_id`ã€`content_type`ã€ä½œè€…åç§°ã€åˆ›å»ºæ—¶é—´ã€ä»¥åŠç‰¹å®šå¹³å°çš„å­—æ®µï¼ˆå¦‚ç‚¹èµ/æŠ•ç¥¨æ•°ã€æ ‡ç­¾ç­‰ï¼‰ã€‚æ˜ å°„å…³ç³»åˆ™å»ºç«‹äº† FAISS å†…éƒ¨å‘é‡ ID ä¸ LangChain `Document` å¯¹è±¡ï¼ˆåŠå…¶å…ƒæ•°æ®ï¼‰å­˜å‚¨ ID ä¹‹é—´çš„å…³è”ã€‚
            -   **ç”¨é€”**: ç”± LangChain çš„ `FAISS` åº“åœ¨åŠ è½½ç´¢å¼•æ—¶ä½¿ç”¨ï¼Œé…åˆ `index.faiss` æ–‡ä»¶ï¼Œèƒ½å¤Ÿå°†æœç´¢ç»“æœè¿˜åŸä¸ºåŒ…å«å®Œæ•´ä¸Šä¸‹æ–‡ä¿¡æ¯çš„ `Document` å¯¹è±¡ã€‚
    -   **æ•°æ®åº“è·Ÿè¸ª**: Django æ¨¡å‹ `ContentIndex` (`django_apps/search/models.py`) åœ¨æ•°æ®åº“å±‚é¢è®°å½•å“ªäº›å†…å®¹æ¡ç›®ï¼ˆé€šè¿‡ `source` å’Œ `thread_id` å”¯ä¸€è¯†åˆ«ï¼‰å·²è¢«æˆåŠŸå¤„ç†å¹¶çº³å…¥ FAISS ç´¢å¼•ä¸­ã€‚

-   **ç´¢å¼•æµç¨‹**:
    -   **è§¦å‘ç´¢å¼•**: å¯¹å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„å†…å®¹è¿›è¡Œç´¢å¼•çš„ä¸»è¦æ–¹å¼æ˜¯å‘ `/index_content/` ç«¯ç‚¹å‘é€ HTTP POST è¯·æ±‚ã€‚
        ```bash
        # ä¸ºç‰¹å®šå¹³å°å»ºç«‹ç´¢å¼• (ä¾‹å¦‚ rednote)
        curl -X POST http://localhost:8000/index_content/ -d "source=rednote"

        # ä¸ºæ‰€æœ‰å¹³å°å»ºç«‹ç´¢å¼•
        curl -X POST http://localhost:8000/index_content/ -d "source=all"
        ```
    -   **åç«¯é€»è¾‘**: è¯¥è¯·æ±‚ç”± `django_apps/search/views.py` ä¸­çš„ `index_content` è§†å›¾å¤„ç†ã€‚
        1.  **ç¡®å®šå¹³å°**: æ ¹æ® POST è¯·æ±‚æ•°æ®ç¡®å®šéœ€è¦ç´¢å¼•çš„å¹³å°ã€‚
        2.  **æŸ¥æ‰¾æœªç´¢å¼•å†…å®¹**: æŸ¥è¯¢å¯¹åº”å¹³å°çš„å†…å®¹æ¨¡å‹ï¼ˆä¾‹å¦‚ `RednoteContent`ï¼‰ï¼Œé€šè¿‡æ¯”è¾ƒ `ContentIndex` è¡¨ä¸­å·²è®°å½•çš„ `thread_id`ï¼Œæ‰¾å‡ºå°šæœªè¢«ç´¢å¼•çš„æ¡ç›®ã€‚
        3.  **è°ƒç”¨ç´¢å¼•å™¨**: å¦‚æœæ‰¾åˆ°æœªç´¢å¼•æ¡ç›®ï¼Œåˆ™è°ƒç”¨ `index_service.indexer.index_platform_content()`ã€‚
        4.  **å¤„ç†æ¡ç›®**: `Indexer.index_platform_content` æ–¹æ³• (`django_apps/search/index_service/indexer.py` ä¸­) éå†è¿™äº›æœªç´¢å¼•çš„æ¡ç›®ï¼š
            -   **ç”Ÿæˆ Embedding**: è°ƒç”¨ `_batch_create_embeddings` ä¸ºæ¡ç›®çš„ `content` å­—æ®µç”Ÿæˆ Embedding å‘é‡ã€‚
            -   **æ·»åŠ è‡³ FAISS**: è°ƒç”¨ `faiss_manager.add_texts()` å°†æ–‡æœ¬å†…å®¹ã€å…ƒæ•°æ®å’Œç”Ÿæˆçš„ Embedding æ·»åŠ åˆ°å†…å­˜ä¸­çš„ FAISS ç´¢å¼•ï¼ˆæ›´æ–° `index.faiss` å’Œ `index.pkl` çš„å†…å­˜è¡¨ç¤ºï¼‰ã€‚
            -   **è®°å½•ç´¢å¼•çŠ¶æ€**: åœ¨ `ContentIndex` æ•°æ®åº“è¡¨ä¸­åˆ›å»ºä¸€æ¡æ–°è®°å½•ï¼Œæ ‡è®°è¯¥ `thread_id` å·²è¢«ç´¢å¼•ã€‚
            -   **æ¸…ç©ºåŸæ–‡**: **å…³é”®æ­¥éª¤** - æˆåŠŸå°† Embedding å’Œå…ƒæ•°æ®æ·»åŠ åˆ° FAISS å¹¶è®°å½•åˆ° `ContentIndex` åï¼Œå°†åŸå§‹æ•°æ®åº“è®°å½•ï¼ˆå¦‚ `RednoteContent` å¯¹è±¡ï¼‰çš„ `content` å­—æ®µæ›´æ–°ä¸º `None`ï¼Œä»¥èŠ‚çœæ•°æ®åº“å­˜å‚¨ç©ºé—´ã€‚
            -   **ä¿å­˜åˆ°ç£ç›˜**: å½“ä¸€æ‰¹æˆ–æ‰€æœ‰æœªç´¢å¼•æ¡ç›®å¤„ç†å®Œæ¯•åï¼Œè°ƒç”¨ `faiss_manager.save_index()` å°†å†…å­˜ä¸­æ›´æ–°åçš„ FAISS ç´¢å¼• (`index.faiss`) å’Œå…ƒæ•°æ®å­˜å‚¨ (`index.pkl`) åŸå­æ€§åœ°å†™å…¥ç£ç›˜æ–‡ä»¶ã€‚
    -   **"Skipping object..." æ—¥å¿—**: (ä»¥ä¸‹æ˜¯é’ˆå¯¹å‡ºç°è¯¥æ—¥å¿—çš„æƒ…å†µè¯´æ˜)
        -   **ç°è±¡**: åœ¨è¿è¡Œç´¢å¼•å‘½ä»¤æ—¶ï¼Œå¯èƒ½ä¼šçœ‹åˆ°ç±»ä¼¼ `Skipping object with ID xx due to empty content` çš„æ—¥å¿—ä¿¡æ¯ã€‚
        -   **åŸå› **: è¿™é€šå¸¸å‘ç”Ÿåœ¨ä»¥ä¸‹æƒ…å†µï¼šæŸä¸ªå†…å®¹æ¡ç›®**ä¹‹å‰å·²ç»è¢«æˆåŠŸç´¢å¼•è¿‡**ï¼Œå› æ­¤å…¶åœ¨æ•°æ®åº“ä¸­çš„ `content` å­—æ®µå·²è¢«æ¸…ç©ºï¼ˆè®¾ä¸º `None`ï¼‰ã€‚ä½†åæ¥ç”±äºæŸç§åŸå› ï¼ˆä¾‹å¦‚æ•°æ®åº“æ‰‹åŠ¨æ“ä½œã€è¿ç§»é—®é¢˜æˆ–å…¶ä»–æœªçŸ¥é”™è¯¯ï¼‰ï¼Œè¯¥æ¡ç›®åœ¨ `ContentIndex` è¡¨ä¸­å¯¹åº”çš„è®°å½•**è¢«æ„å¤–åˆ é™¤äº†**ã€‚å½“ç´¢å¼•æµç¨‹å†æ¬¡è¿è¡Œæ—¶ï¼Œå®ƒæ ¹æ® `ContentIndex` è¡¨åˆ¤æ–­è¯¥æ¡ç›®æ˜¯â€œæœªç´¢å¼•â€çš„ï¼Œä½†åœ¨å°è¯•è¯»å–å…¶ `content` å­—æ®µä»¥ç”Ÿæˆ Embedding æ—¶å‘ç°æ˜¯ç©ºçš„ï¼Œå› æ­¤åªèƒ½è·³è¿‡å¤„ç†å¹¶æ‰“å°æ­¤æ—¥å¿—ã€‚
        -   **å½±å“**: è¿™é€šå¸¸ä¸å½±å“ç³»ç»Ÿçš„æ­£å¸¸æ£€ç´¢åŠŸèƒ½ï¼ˆå› ä¸ºè¯¥æ¡ç›®çš„å‘é‡å’Œå…ƒæ•°æ®ä»åœ¨ FAISS æ–‡ä»¶ä¸­ï¼‰ï¼Œä½†å®ƒæç¤ºå¯èƒ½å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚
    -   **å¼ƒç”¨å‘½ä»¤**: **è¯·å‹¿ä½¿ç”¨** æ—§çš„ç®¡ç†å‘½ä»¤ `python manage.py initialize_index` æˆ– `python manage.py index_content`ã€‚è¿™äº›å·²è¢«å¼ƒç”¨ã€‚å½“å‰æ­£ç¡®çš„è§¦å‘æ–¹å¼æ˜¯ä½¿ç”¨ä¸Šé¢æè¿°çš„ `/index_content/` POST è¯·æ±‚ã€‚


### æ··åˆæ£€ç´¢

-   **æ¦‚å¿µ**: ç³»ç»Ÿé‡‡ç”¨æ··åˆæ£€ç´¢ç­–ç•¥ï¼Œç»“åˆè¯­ä¹‰ç›¸ä¼¼æ€§ï¼ˆé€šè¿‡ FAISS è¿›è¡Œå‘é‡æœç´¢ï¼‰ã€å…³é”®å­—ç›¸å…³æ€§ï¼ˆBM25 æ–‡æœ¬æœç´¢ï¼‰ä»¥åŠç¤¾äº¤åª’ä½“å¯ä¿¡åº¦ï¼ˆæŠ•ç¥¨/ç‚¹èµæ•°ï¼‰ï¼Œä»¥æé«˜æ£€ç´¢æ–‡æ¡£çš„ç›¸å…³æ€§ã€‚
-   **å®ç°**: æ ¸å¿ƒé€»è¾‘ä½äº `HybridRetriever` ç±» (`django_apps/search/index_service/hybrid_retriever.py`) ä¸­ã€‚ä¸»è¦çš„ `retrieve` æ–¹æ³•æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
    1.  **å€™é€‰é›†è·å–**: ä½¿ç”¨ FAISS å‘é‡ç›¸ä¼¼æ€§æœç´¢ (`faiss_manager.search`) å’Œ BM25 æ–‡æœ¬æœç´¢ (`faiss_manager.search_bm25`) è·å–åˆå§‹å€™é€‰æ–‡æ¡£é›†ã€‚è¿™é‡Œä½¿ç”¨è¾ƒå¤§çš„ `top_k` ä¹˜æ•°ä»¥ç¡®ä¿æœ‰è¶³å¤Ÿå¹¿æ³›çš„å€™é€‰æ± ã€‚
    2.  **æ–‡æ¡£æ± åŒ–**: å°†ä¸¤ä¸ªæœç´¢çš„ç»“æœåˆå¹¶åˆ°ä¸€ä¸ªä»¥æ–‡æ¡£ ID ä¸ºé”®çš„å­—å…¸ä¸­ï¼Œä»¥è¿›è¡Œå»é‡ã€‚
    3.  **åˆ†æ•°æå–**: è®°å½•æ¯ä¸ªå”¯ä¸€æ–‡æ¡£çš„ BM25 åˆ†æ•°ã€Embedding ç›¸ä¼¼åº¦åˆ†æ•°å’ŒæŠ•ç¥¨åˆ†æ•°ï¼ˆé€šè¿‡ `get_doc_vote_score` ä»å…ƒæ•°æ®ä¸­æå–çš„ç‚¹èµ/æŠ•ç¥¨æ•°ï¼‰ã€‚
    4.  **å½’ä¸€åŒ–**: å¯¹æ± ä¸­æ‰€æœ‰æ–‡æ¡£çš„æ¯ç§æ£€ç´¢æ–¹æ³•ï¼ˆBM25ã€Embeddingã€æŠ•ç¥¨ï¼‰çš„åˆ†æ•°åˆ†åˆ«è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œæ˜ å°„åˆ° [0, 1] åŒºé—´ï¼ˆä½¿ç”¨ `normalize` å’Œ `normalize_embedding_list` æ–¹æ³•ï¼‰ã€‚
    5.  **åŠ æƒç»„åˆ**: ä½¿ç”¨å¯é…ç½®çš„æƒé‡ï¼ˆåœ¨ `django_apps/search/views.py` ä¸­åˆå§‹åŒ– `HybridRetriever` æ—¶å®šä¹‰ï¼Œä¾‹å¦‚ `bm25_weight=0.25`, `embedding_weight=0.55`, `vote_weight=0.2`ï¼‰ç»„åˆå½’ä¸€åŒ–åçš„åˆ†æ•°ï¼Œè®¡ç®—æ¯ä¸ªæ–‡æ¡£çš„æœ€ç»ˆç›¸å…³æ€§åˆ†æ•°ã€‚
    6.  **é˜ˆå€¼è¿‡æ»¤**: è¿‡æ»¤æ‰ç»„åˆç›¸å…³æ€§åˆ†æ•°ä½äºæŒ‡å®š `relevance_threshold`ï¼ˆä¾‹å¦‚ 0.5 æˆ– 0.6ï¼Œåœ¨ `views.py` ä¸­è®¾ç½®ï¼Œä¸» README å¯èƒ½ä¹Ÿæœ‰æåŠï¼‰çš„æ–‡æ¡£ã€‚
    7.  **æ’åº**: å‰©ä½™æ–‡æ¡£æŒ‰æœ€ç»ˆç»„åˆåˆ†æ•°é™åºæ’åˆ—ã€‚
    8.  **Top-K é€‰æ‹©**: è¿”å›åˆ†æ•°æœ€é«˜çš„ `k` ä¸ªæ–‡æ¡£ã€‚
-   **BM25 åˆå§‹åŒ–**: BM25 ç´¢å¼•åœ¨åŠ è½½ FAISS ç´¢å¼•æ—¶äº `FaissManager` (`django_apps/search/index_service/faiss_manager.py`) å†…é€šè¿‡ `_initialize_bm25_from_faiss` è¿›è¡Œåˆå§‹åŒ–ã€‚å®ƒä½¿ç”¨å­˜å‚¨åœ¨ FAISS Docstore (`index.pkl`) ä¸­çš„æ–‡æœ¬ä½œä¸ºå…¶è¯­æ–™åº“ã€‚


### æ¨èç±»å¤„ç†é€»è¾‘

#### 1. å¤„ç†æµç¨‹

1. **æ¥æ”¶æŸ¥è¯¢ä¸æ–‡æ¡£**  
   æ¥æ”¶ç”¨æˆ·çš„æ¨èç±»æŸ¥è¯¢ä»¥åŠæ£€ç´¢åˆ°çš„ç›¸å…³æ–‡æ¡£é›†åˆã€‚

2. **æå–æ¨èé¡¹**  
   ä½¿ç”¨ LLM ä»æ£€ç´¢åˆ°çš„æ–‡æ¡£ä¸­æå–æ‰€æœ‰æ¨èé¡¹ç›®åŠå…¶ç›¸å…³ä¿¡æ¯ã€‚

3. **æƒ…æ„Ÿåˆ†æä¸è¯„åˆ†**  
   å¯¹æ¯ä¸ªæ¨èé¡¹çš„ç›¸å…³å¸–å­å†…å®¹è¿›è¡Œæƒ…æ„Ÿåˆ†æï¼Œå¹¶æ˜ å°„ä¸º 1â€“5 åˆ†åˆ¶è¯„åˆ†ã€‚

4. **è®¡ç®—ç»¼åˆåˆ†æ•°**  
   æ ¹æ®æƒ…æ„Ÿè¯„åˆ†ã€å¸–å­ç‚¹èµæ•°å’ŒæåŠæ¬¡æ•°è®¡ç®—ç»¼åˆå¾—åˆ†ã€‚

5. **æ’åºä¸è¿”å›**  
   æŒ‰ç»¼åˆå¾—åˆ†é™åºæ’åºï¼Œè¿”å›å‰ K ä¸ªæ ¼å¼åŒ–çš„æ¨èç»“æœã€‚

#### 2. æ ¸å¿ƒå®ç°é€»è¾‘

##### 2.1 æå–æ¨èé¡¹ç›®

- **æç¤ºè¯æ„å»º** (`_build_extraction_prompt`)  
  è¦æ±‚ LLM ä»æ–‡æ¡£ä¸­è¯†åˆ«æ‰€æœ‰æ¨èé¡¹ç›®ï¼Œå¹¶ä¸ºæ¯ä¸ªé¡¹ç›®æå–ï¼š  
  - é¡¹ç›®åç§°  
  - æ‰€æœ‰æåŠè¯¥é¡¹ç›®çš„å¸–å­  
    - å¸–å­åŸæ–‡å†…å®¹  
    - å¸–å­ç‚¹èµæ•°  
    - åŸºäºæƒ…æ„Ÿçš„è¯„åˆ†ï¼ˆ1â€“5 åˆ†ï¼‰  
  - é¡¹ç›®è¯„è®ºæ‘˜è¦ï¼ˆ2â€“3 å¥ï¼‰

- **è°ƒç”¨ LLM** (`_call_llm_for_extraction`)  
  ä½¿ç”¨ Gemini å¤„ç†æ–‡æœ¬å¹¶ä»å“åº”ä¸­è§£æå‡º JSON æ ¼å¼çš„æ•°æ®ã€‚

##### 2.2 æ¨èé¡¹å¤„ç†

å¯¹æ¯ä¸ªæå–å‡ºçš„é¡¹ç›®ï¼Œç³»ç»Ÿä¼šï¼š

1. è®¡ç®— **æ€»ç‚¹èµæ•°** (`total_upvotes`)  
2. å¯¹æ¯æ¡å¸–å­è°ƒç”¨ `_analyze_sentiment` è¿›è¡Œæƒ…æ„Ÿåˆ†æ  
3. è®¡ç®— **å¹³å‡æƒ…æ„Ÿè¯„åˆ†** (`avg_rating = round(avg_rating, 2)`)  
4. ç»Ÿè®¡ **æåŠæ¬¡æ•°** (`mentions`)  
5. æ„å»ºåŒ…å«ä»¥ä¸‹å­—æ®µçš„æ¨èå¯¹è±¡ï¼š
   ```python
   recommendation = {
       'name': item['name'],
       'total_upvotes': total_upvotes,
       'avg_rating': avg_rating,
       'mentions': mentions,
       'posts': posts_with_ratings,
       'summary': item.get('summary', 'æ²¡æœ‰æ‘˜è¦')
   }
```
#### 2.3 æƒ…æ„Ÿåˆ†æä¸è¯„åˆ†

- **ä½¿ç”¨**: `RatingProcessor`  
  - **å†…å®¹æå–**: `_extract_item_related_content`  
  - **æƒ…æ„Ÿåˆ†ç±»**: `"very positive"`, `"positive"`, `"neutral"`, `"negative"`, `"very negative"`  
  - **è¯„åˆ†æ˜ å°„**: `sentiment_to_rating` â†’ `[5.0, 4.0, 3.0, 2.0, 1.0]`  

#### 2.4 ç»¼åˆåˆ†æ•°è®¡ç®—

- **æ–¹æ³•**: `_calculate_scores`  
- **åŠ æƒç»„æˆ**:  
  - æƒ…æ„Ÿè¯„åˆ†ç»„ä»¶ (`rating_component`): æƒé‡ 0.4  
  - ç‚¹èµç»„ä»¶ (`upvote_component`): æƒé‡ 0.35  
  - æåŠç»„ä»¶ (`mention_component`): æƒé‡ 0.25  
- **è®¡ç®—å…¬å¼**:  
ç»¼åˆå¾—åˆ† = 0.4 Ã— avg_rating + 0.35 Ã— normalized_upvotes + 0.25 Ã— normalized_mentions

#### 2.5 æ’åºä¸æ ¼å¼åŒ–ç»“æœ
- _format_results å°†æ’åºåçš„æ¨èé¡¹è½¬æ¢ä¸ºæ–‡æ¡£å¯¹è±¡
- æ¯ä¸ªæ–‡æ¡£åŒ…å«æ ¼å¼åŒ–å†…å®¹ï¼Œæ˜¾ç¤ºé¡¹ç›®åç§°ã€è¯„åˆ†ã€ç‚¹èµæ•°ã€å¾—åˆ†è¯¦æƒ…å’Œè¯„è®ºè¯¦æƒ…
- æ‰€æœ‰åŸå§‹æ•°æ®ä¿å­˜åœ¨æ–‡æ¡£çš„ `metadata` å­—æ®µï¼Œä¾¿äºå‰ç«¯è¿›ä¸€æ­¥å¤„ç†  

#### 3. è°ƒè¯•ä¸æ‰©å±•

- ç³»ç»Ÿåœ¨LLMè°ƒç”¨å¤±è´¥æ—¶ä¼šè¿”å›æ¨¡æ‹Ÿæ•°æ®ï¼Œä¾¿äºæµ‹è¯•å’Œå¼€å‘  

- **TODO**  
1. **JSON è§£æå®‰å…¨æ€§**  
   - ç›®å‰é€šè¿‡æ­£åˆ™ä¿®å¤æ— æ•ˆè½¬ä¹‰  
   - åç»­åº”é€šè¿‡æç¤ºè¯çº¦æŸè¾“å‡ºæ ¼å¼  
2. **æƒ…æ„Ÿåˆ†ææç¤ºè¯ä¼˜åŒ–**  
   - éªŒè¯ LLM å¯¹äº”ç±»æƒ…æ„Ÿçš„åŒºåˆ†æ˜¯å¦è¶³å¤Ÿå‡†ç¡®  
3. **ç›¸å…³å†…å®¹æå–é²æ£’æ€§**  
   - ä¿è¯ç›¸åŒæŸ¥è¯¢èƒ½ç¨³å®šåœ°æå–ç›¸åŒå†…å®¹  



### Prompt ç”Ÿæˆä¸retrieved documentså……åˆ†æ€§åˆ¤æ–­ 
(
-   **Prompt ç»“æ„**: å‘é€ç»™ LLM çš„æœ€ç»ˆ Prompt ç”± `search_process/prompt_generator/generator.py` ä¸­çš„ `generate_prompt` å‡½æ•°æ„å»ºã€‚å®ƒåŒ…å«ï¼š
    -   è§’è‰²å®šä¹‰ï¼ˆåŸºäºå¹³å°ï¼‰ã€‚
    -   ç”¨æˆ·æŸ¥è¯¢ã€‚
    -   æœ€è¿‘çš„èŠå¤©è®°å½•ï¼ˆé€šè¿‡ `MemoryService` è·å–ï¼‰ã€‚
    -   æ£€ç´¢åˆ°çš„æ–‡æ¡£ï¼ˆå¦‚æœæ•°é‡è¶³å¤Ÿï¼‰ã€‚
    -   è¾“å‡ºæ ¼å¼è¯´æ˜ã€‚
    -   åŸºäºæŸ¥è¯¢åˆ†ç±»çš„ç‰¹å®šæŒ‡ä»¤ã€‚ )




-   **æ–‡æ¡£å……åˆ†æ€§æ£€æŸ¥**: RAG ä¸Šä¸‹æ–‡ï¼ˆæ£€ç´¢åˆ°çš„æ–‡æ¡£ï¼‰ä»…åœ¨ `HybridRetriever` æ£€ç´¢åˆ° **è‡³å°‘ 5 ï¼ˆç›®å‰è®¾ç½®çš„æ•°é‡ï¼Œä¹‹åä¼šæ ¹æ®æƒ…å†µä¼˜åŒ–è°ƒæ•´ï¼‰ä¸ª** æ–‡æ¡£æ—¶æ‰åŒ…å«åœ¨ Prompt ä¸­ã€‚æ­¤æ£€æŸ¥ç›´æ¥åœ¨ `generate_prompt` å‡½æ•°å†…è¿›è¡Œï¼š
    ```python
    # search_process/prompt_generator/generator.py
    # ...
    if len(retrieved_docs) >= 5:
        prompt.append(
            "## Relevant Documents\\n"
            # ... åœ¨ prompt ä¸­åŒ…å«æ–‡æ¡£ ...
        )
    else:
        prompt.append (
            "No relevant documents were retrieved. Please attempt to answer based on your general knowledge.\\n\\n"
        )
    ```
    -   å¦‚æœæ£€ç´¢åˆ°çš„æ–‡æ¡£å°‘äº 5 ä¸ªï¼ŒPrompt ä¼šæŒ‡ç¤º LLM æ ¹æ®å…¶é€šç”¨çŸ¥è¯†è¿›è¡Œå›ç­”ã€‚
    -   æ³¨æ„ï¼š`HybridRetriever` æœ¬èº«å¯èƒ½å·²æ ¹æ® `relevance_threshold` è¿‡æ»¤äº†æ–‡æ¡£ï¼Œå› æ­¤ä¼ é€’ç»™ `generate_prompt` çš„æœ€ç»ˆæ•°é‡å¯èƒ½å°‘äºæœ€åˆè¯·æ±‚çš„ `top_k`ã€‚





â€”------
# 15. Frontend
| Path | Purpose |
| `Frontend/` : Vite + React (TypeScript) single-page app
| `Project/` : Django backend (runs on `127.0.0.1:8000`)
| `.env` : Front-end env vars (`VITE_BACKEND_URL`)
| `src/pages/SummaryPage.tsx` : Chat-like search screen
| `src/components/Sidebar.tsx` : Model selector + chat list
| `src/components/QuestionTemplates.tsx` : Search suggestions popup


### How to run:
```bash
cd Frontend
npm run dev
```

