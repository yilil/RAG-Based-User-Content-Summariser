<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Advanced Search Interface</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #f4f4f9;
    }
    .search-container {
      text-align: center;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      width: 400px;
      position: relative;
    }
    .search-container h2 {
      margin-bottom: 15px;
    }
    .search-container form {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .search-container input {
      width: 90%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-bottom: 10px;
    }
    .search-container button {
      padding: 10px 20px;
      border: none;
      background: #007bff;
      color: #fff;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
    }
    .search-container button:hover {
      background: #0056b3;
    }

    /* Dropdown suggestions list */
    .suggestions-list {
      position: absolute;
      top: 135px;
      left: 20px;
      width: calc(100% - 40px);
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      display: none;
      text-align: left;
      z-index: 99;
      max-height: 240px; /* Set a max height */
      overflow-y: auto;  /* Show scroll if content overflows */
    }
    .suggestions-list ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .suggestions-list li {
      padding: 10px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
    }
    .suggestions-list li:hover {
      background-color: #f0f0f0;
    }

    /* Highlight matched query */
    .highlight {
      background-color: yellow;
    }

    /* Examples section */
    .examples {
      margin-top: 15px;
      text-align: left;
    }
    .examples p {
      font-weight: bold;
      margin-bottom: 5px;
    }
    .examples ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .examples li {
      background: #f9f9f9;
      padding: 6px;
      margin-bottom: 5px;
      border-radius: 4px;
      cursor: pointer;
      border: 1px solid #eee;
    }
    .examples li:hover {
      background: #e9e9e9;
    }

    /* Loading styles */
   .loading {
     display: none;
     margin-top: 20px;
     padding: 15px;
     text-align: center;
     color: #666;
     font-style: italic;
     background-color: #f8f9fa;
     border-radius: 4px;
    }
    .loading::after {
     content: '...';
     animation: dots 1.5s steps(5, end) infinite;
    }

   @keyframes dots {
     0%, 20% { content: '.'; }
     40% { content: '..'; }
     60% { content: '...'; }
     80%, 100% { content: ''; }
    }

    /* Results section */
   .result {
     margin-top: 20px;
     padding: 15px;
     background-color: #f8f9fa;
     border-radius: 4px;
     text-align: left;
   }
  </style>

</head>
<body>
  <div class="search-container">
    <h2>Search</h2>
    <form method="POST" action="{% url 'search' %}">
        {% csrf_token %}
        <label for="llm_model">Select LLM Model:</label>
        <select id="llm_model" name="llm_model">
          <option value="gemini-1.5-flash" {% if llm_model == 'gemini-1.5-flash' %}selected{% endif %}>Gemini 1.5 Flash</option>
          <option value="gemini-1.0-pro" {% if llm_model == 'gemini-1.0-pro' %}selected{% endif %}>Gemini 1.0 Pro</option>
          <option value="gemini-1.5-pro" {% if llm_model == 'gemini-1.5-pro' %}selected{% endif %}>Gemini 1.5 Pro</option>
          <option value="gemini-2.0-flash-exp" {% if llm_model == 'gemini-2.0-flash-exp' %}selected{% endif %}>Gemini 2.0 Flash</option>
        </select>
        <button type="submit">Submit</button>
    </form>
  
    <form id="search-form" method="POST" action="{% url 'search' %}">  
      {% csrf_token %}
      <input
        type="text"
        name="search_query"
        id="search-input"
        placeholder="Enter your question..."
        required
        autocomplete="off"
      />
      <button type="submit">Submit</button>
    </form>

    <!-- Loading indicator -->
    <div id="loading" class="loading">
      Processing your request
    </div>

    {% if result %}
    <div class="result">
      <h3>Results:</h3>
      <p>{{ result }}</p>
    </div>
    {% endif %}


    <!-- Container for dropdown suggestions -->
    <div class="suggestions-list" id="suggestions-list">
      <ul id="suggestions-ul"></ul>
    </div>

    <!-- Examples section -->
    <div class="examples">
      <p>Try these examples:</p>
      <ul>
        <li onclick="fillExample('Best restaurants in Sydney?')">Best restaurants in New York?</li>
        <li onclick="fillExample('Popular travel destinations for 2024?')">Popular travel destinations for 2024?</li>
        <li onclick="fillExample('Top Python frameworks to learn?')">Top Python frameworks to learn?</li>
        <li onclick="fillExample('Fashion trends for fall 2024?')">Fashion trends for fall 2024?</li>
      </ul>
    </div>
  </div>

  <script>
    // Simulated local data source for suggestions (replace with an API if needed)
    const suggestionsData = [
      "Best restaurants in Sydney",
      "How to cook a perfect steak",
      "Popular travel destinations for 2024",
      "Weekend getaways near me",
      "Top Python frameworks to learn",
      "JavaScript tips for beginners",
      "Fashion trends for fall 2024",
      "Best Netflix shows to watch",
      "Healthy snack ideas",
      "SQL vs NoSQL for user data storage",
      "Tips to build a Node.js server",
      "Budget-friendly travel options",
      "Nightlife hotspots in Tokyo",
      "Hiking trails near Los Angeles",
      "Recommended coding bootcamps",
      "Vegan dessert recipes",
      "Best workout routines for beginners",
      "Must-see attractions in Paris",
      "How to learn React fast",
      "Best cloud hosting providers",
      "Winter clothing ideas",
      "Low-carb diet recipes",
      "Best restaurants in San Francisco",
      "Easy meal prep for the week",
      "Top beaches to visit in summer",
      "Mobile app development guide",
      "Short city breaks in Europe",
      "Trendy streetwear brands",
      "Latest smartphone releases",
      "Best coffee shops near me",
      "Building a personal finance plan",
      "How to optimize SEO for my website",
      "Top video games in 2024"
      // Add more
    ];

    const searchInput = document.getElementById('search-input');
    const suggestionsContainer = document.getElementById('suggestions-list');
    const suggestionsUl = document.getElementById('suggestions-ul');
    const searchForm = document.getElementById('search-form');
    const loadingIndicator = document.getElementById('loading');

    // Form submit handler
    searchForm.addEventListener('submit', function(e) {
      loadingIndicator.style.display = 'block';
    });

    // Triggered when the user types in the search box
    searchInput.addEventListener('input', () => {
      const query = searchInput.value.trim();
      suggestionsUl.innerHTML = '';

      if (!query) {
        suggestionsContainer.style.display = 'none';
        return;
      }

      // Convert to lowercase for matching, but keep original string for display
      const lowerCaseQuery = query.toLowerCase();

      // Filter to find matches
      let filteredSuggestions = suggestionsData.filter(item =>
        item.toLowerCase().includes(lowerCaseQuery)
      );

      // Limit to top 10 results
      filteredSuggestions = filteredSuggestions.slice(0, 10);

      if (filteredSuggestions.length > 0) {
        filteredSuggestions.forEach(item => {
          // Highlight matched substring
          const highlightedItem = highlightText(item, query);
          const li = document.createElement('li');
          li.innerHTML = highlightedItem; 
          li.addEventListener('click', () => {
            searchInput.value = item; // Fill in the search bar
            suggestionsContainer.style.display = 'none';
          });
          suggestionsUl.appendChild(li);
        });
        suggestionsContainer.style.display = 'block';
      } else {
        suggestionsContainer.style.display = 'none';
      }
    });

    // Function to fill example when clicked
    function fillExample(exampleText) {
      searchInput.value = exampleText;
      suggestionsContainer.style.display = 'none';
    }

    // Function to highlight matched query
    function highlightText(text, query) {
      const index = text.toLowerCase().indexOf(query.toLowerCase());
      if (index === -1) {
        return text;
      }
      const beforeMatch = text.slice(0, index);
      const match = text.slice(index, index + query.length);
      const afterMatch = text.slice(index + query.length);
      return `${beforeMatch}<span class="highlight">${match}</span>${afterMatch}`;
    }
  </script>
</body>
</html>
